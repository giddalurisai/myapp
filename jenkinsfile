pipeline {
	parameters {
  choice choices: ['dev', 'stag', 'master'], description: 'please select Branch', name: 'Branch'
}

    agent {
  label 'sai_slave'
}
	environment {
  PATH = "/opt/maven/bin:$PATH"
}
    stages {
        stage('Hello') {
            steps {
                echo 'Hello World'
            }
        }
		stage ('checkout') {
		steps {
		checkout([$class: 'GitSCM', branches: [[name: "*/${Branch}"]], extensions: [], userRemoteConfigs: [[credentialsId: 'gitHUBCRED', url: 'https://github.com/giddalurisai/myapp.git']]])
		}
		}
		stage('build') {
		steps {
		sh 'mvn package'
    }
}
	stage('Artifact uploader') {
		steps {
		script {
		def mavenPom file = readMavenPom 'pom.xml'
		nexusArtifactUploader artifacts: [[artifactId: 'hello-world-war', classifier: '', file: "/home/ec2-user/workspace/saipipeline/target/hello-world-war-${mavenPom.version}.war", type: 'war']], credentialsId: 'sai-nexus-cred', groupId: 'com.efsavage', nexusUrl: '3.110.20.247:8081', nexusVersion: 'nexus3', protocol: 'http', repository: 'sai', version: "${mavenPom.version}"
	}		
	}
}
		stage('deploy') {
		steps {
		deploy adapters: [tomcat8(credentialsId: 'tom_CRED_sai', path: '', url: 'http://35.154.244.119:8080')], contextPath: 'nandu', war: '**/*.war'
}
}
}
}
